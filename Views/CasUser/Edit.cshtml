@model RentCar.Models.CR_Cas_User_Information

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_CASLayout.cshtml";
}


<head>
    <link href="/Bootstrap_Arabic/jquery.dataTables.min.css" type="text/css" rel="stylesheet" />
</head>

<style>
    .card-box.table-responsive {
        overflow: auto;
        height: 89vh !important;
    }

    .tooltip > .tooltip-inner {
        background-color: #f00;
    }

    .tooltip > .tooltip-arrow {
        border-top-color: #f00 !important;
    }
</style>
<style>
    /* The container */
    .checkbox_input {
        display: block;
        position: relative;
        padding-right: 35px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 15px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        text-align: right
    }

        /* Hide the browser's default checkbox */
        .checkbox_input input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

    /* Create a custom checkbox */
    .checkmark {
        position: absolute;
        top: 0;
        right: 0;
        height: 20px;
        width: 20px;
        background-color: #fff;
        border: solid 2px #4980B2;
    }

    /* On mouse-over, add a grey background color */
    .container:hover input ~ .checkmark {
        background-color: #fff;
        border: solid 2px #4980B2;
        color: #4980B2
    }

    /* When the checkbox is checked, add a blue background */
    .checkbox_input input:checked ~ .checkmark {
        background-color: #fff;
        border: solid 2px #4980B2;
        color: #4980B2
    }

    /* Create the checkmark/indicator (hidden when not checked) */
    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
    }

    /* Show the checkmark when checked */
    .checkbox_input input:checked ~ .checkmark:after {
        display: block;
    }

    /* Style the checkmark/indicator */
    .checkbox_input .checkmark:after {
        left: 6px;
        top: 3px;
        width: 5px;
        height: 10px;
        border: solid #4980B2;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
    }
</style>
<div class="content">

    <!-- Start Content-->
    <div class="container-fluid">

        <div class="row">
            <div class="col-12">
                <div class="card-box table-responsive" style="height:90vh; overflow:auto">
                    <div class="title_corp"><h3> المستخدمين / المستخدمين / تعديل </h3></div>
                    <div class="subtitle_corp">تمكنك هذه الصفحة من تعديل بيانات المستخدم </div>
                    <div class="hr_60"></div>
                    <div class="hr_80"></div>
                    <div class="corp_page " style=" padding-top: 20px;">
                        <div class="page_content">

                            <form id="form_validation" action="/CasUser/Edit" enctype="multipart/form-data" method="post" data-parsley-validate novalidate>

                                @Html.AntiForgeryToken()
                                <div class="form-horizontal" style="min-height:70%">
                                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                    @Html.HiddenFor(Model => Model.CR_Cas_User_Information_Lessor_Code)
                                    <div class="row">
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>   رقم المستخدم<label id="asterisk">*</label></label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.TextBoxFor(model => model.CR_Cas_User_Information_Id,
                                                   htmlAttributes: new { @class = "form-control ", style = "float:right;", onpaste = "return false;", maxlength = "10", oninput = "this.value=this.value.replace(/[^0-9]/g,'')", Readonly = "true" })
                                                    <div><span id="textErr"></span></div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-4 padding_left_none">
                                                    <label>إسم المستخدم عربي<label id="asterisk">*</label></label>
                                                </div>
                                                <div class="col-md-8 padding_right_none">
                                                    @Html.TextBoxFor(model => model.CR_Cas_User_Information_Ar_Name,
                                                   htmlAttributes: new { @class = "form-control ", style = "float:right;", onpaste = "return false;", onkeypress = "return CheckArabicCharactersOnly(event);", maxlength = "50", Readonly = "true" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-4 padding_left_none">
                                                    <label>إسم المستخدم إنجليزي<label id="asterisk">*</label></label>
                                                </div>
                                                <div class="col-md-8 padding_right_none">
                                                    @Html.TextBoxFor(model => model.CR_Cas_User_Information_En_Name,
                                                   htmlAttributes: new { @class = "form-control ", style = "float:right;", onpaste = "return false;", oninput = "this.value=this.value.replace(/[^a-zA-Z0-9 àâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇ]/g,'')", maxlength = "50", Readonly = "true" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>رقم الجوال</label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.TextBoxFor(model => model.CR_Cas_User_Information_Mobile,
                                                   htmlAttributes: new { @class = "form-control ", style = "float:right;", onpaste = "return false;", maxlength = "15", oninput = "this.value=this.value.replace(/[^0-9]/g,'')" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>البريد الإلكتروني</label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.TextBoxFor(model => model.CR_Cas_User_Information_Emaile,
                                                   htmlAttributes: new { @class = "form-control ", style = "float:right;", onpaste = "return false;", oninput = "this.value=this.value.replace(/[^a-zA-Z0-9 àâäèéêëîïôœùûüÿçÀÂÄÈÉÊËÎÏÔŒÙÛÜŸÇ]/g,'')", maxlength = "30" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>صلاحية الإدارة</label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.CheckBox("CR_Cas_User_Information_Auth_System", new { htmlAttributes = new { @class = "form-control" }, style = "width:25px;height:25px;" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4" style="float:right;" hidden>
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>صلاحية الفروع</label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.CheckBox("CR_Cas_User_Information_Auth_Branch", new { @onclick = "hideTable();", htmlAttributes = new { @class = "form-control" }, style = "width:25px;height:25px;" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    <label>صلاحية الملاك</label>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @Html.CheckBox("CR_Cas_User_Information_Auth_Owners", new { htmlAttributes = new { @class = "form-control" }, style = "width:25px;height:25px;" })
                                                    <div><span id="textErr"></span></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">

                                                    <div class="input-group">
                                                        <span class="input-group-btn" style="width:100%">
                                                            <span class="btn btn-primary" onclick="$(this).parent().find('input[type=file]').click();" style="width:100%;height:35px;width:100%;line-height:20px;">التوقيع </span>
                                                            <input name="UserSignatureFile" type="file" class="form-control " style="display: none; float: right; width: 100%; object-fit: fill;"
                                                                   accept="image/*" id="UserSignatureFile" onchange="LoadUserSignature(event)">
                                                        </span>
                                                    </div>
                                                    <div><span id="textErr">@ViewBag.UserSign</span></div>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @if (ViewBag.UserSignPath != "")
                                                    {
                                                        <img src="@Url.Content(Model.CR_Cas_User_Information_Signature)" id="UserSignature" class="zoom" width="120" height="80" style="margin-top: -14px; float: right; margin-right: 0; width: 120px; height: 80px; position: relative; object-fit: cover; border: solid 1px #e7e7e7 " />
                                                        <input type="text" id="UserSignaturePath" name="UserSignaturePath" value="@ViewBag.UserSignPath" hidden />
                                                    }
                                                    else
                                                    {
                                                        <img src="" id="UserSignature" class="zoom" width="120" height="80" style="display: none; margin-top: -14px; float: right; margin-right: 0; width: 120px; height: 80px; position: relative; object-fit: cover; border: solid 1px #e7e7e7" />
                                                        <input type="text" id="UserSignaturePath" name="UserSignaturePath" value="@ViewBag.UserSignPath" hidden />
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4" style="float:right;">
                                            <div class="form-group row">
                                                <div class="col-md-6 padding_left_none">
                                                    @*<input type="file" name="UserImgFile" class="form-control " style="float:right;width:100%; object-fit: fill;"
                                                        accept="image/*" id="UserImgFile" onchange="LoadUserImg(event)" />*@
                                                    <div class="input-group">
                                                        <span class="input-group-btn" style="width:100%">
                                                            <span class="btn btn-primary" onclick="$(this).parent().find('input[type=file]').click();" style="width:100%;height:35px;width:100%;line-height:20px;">الصورة</span>
                                                            <input name="UserImgFile" type="file" class="form-control " style="display:none;float:right;width:100%; object-fit: fill;"
                                                                   accept="image/*" id="UserImgFile" onchange="LoadUserImg(event)">
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 padding_right_none">
                                                    @if (ViewBag.UserImgPath != "")
                                                    {
                                                        <img src="@Url.Content(Model.CR_Cas_User_Information_Image)" id="UserImg" class="zoom" width="120" height="80" style="margin-top:-14px;float:right;margin-right:0;width:120px; height:80px;position:relative;object-fit:cover;border:solid 1px #e7e7e7" />
                                                        <input type="text" id="UserImgagePath" name="UserImgagePath" value="@ViewBag.UserImgPath" hidden />
                                                    }
                                                    else
                                                    {
                                                        <img src="" id="UserImg" class="zoom" width="120" height="80" style="display: none; margin-top: -14px; float: right; margin-right: 0; width: 120px; height: 80px; position: relative; object-fit: cover; border: solid 1px #e7e7e7" />
                                                        <input type="text" id="UserImgagePath" name="UserImgagePath" value="@ViewBag.UserImgPath" hidden />
                                                    }

                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    @{
                                        @Html.Action("ValidityList", "CasUser", new { id = ViewBag.UserCode })
                                    }

                                </div>
                                <div class="row" style="margin-top:0px">
                                    <div style="width:100%;padding-left:15px;padding-right:15px;">

                                        <div class="row" style="margin-bottom:5px">
                                            <div class="col-md-6 col-70">

                                                <input type="button" onclick="Save();" name="save" value="حفظ" class="btn btn-primary waves-effect" style="float: right; margin-left: 20px; margin-top: 10px;" />
                                                <input type="submit" name="save" id="save" value="حفظ" class="btn btn-primary waves-effect" style="float: right; margin-left: 20px; margin-top: 10px;" hidden />
                                                <input type="button" name="hold" id="btn-Hold" class="btn btn-primary waves-effect" value="@ViewBag.h" style="float: right; margin-left: 20px; margin-top: 10px;" />
                                                <input type="button" name="delete" class="btn btn-primary waves-effect" id="btn-confirm" value="@ViewBag.stat" style="float: right; margin-left: 20px; margin-top: 10px;" />
                                                <input type="button" onclick="Password();" class="btn btn-primary waves-effect" value="إسترجاع كلمة السر" style="float:right;width:120px;margin-top: 10px;" />
                                                <input type="submit" name="GetPassword" id="GetPassword" class="btn btn-primary waves-effect" value="إسترجاع كلمة السر" hidden />

                                            </div>
                                            <div class="col-md-6 col-30" style="margin-top:10px;margin-bottom:10px;">
                                                <a href="/CasUser/Index/" class="btn btn-primary waves-effect" style="float: left;">انهاء</a>
                                            </div>

                                        </div>



                                        <div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" id="mi-modal">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-body" style="padding: 35px;">
                                                        @*<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>*@
                                                        @if (ViewBag.delete == "D")
                                                        {
                                                            <div style="width:75%;float:right;text-align:right;">
                                                                <b style="color:red;">تأكيد إسترجاع الحذف ......</b><br />
                                                                هل ترغب باسترجاع بيانات المستخدم
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div style="width:75%;float:right;text-align:right;">
                                                                <b style="color:red;">تأكيد الحذف ......</b><br />
                                                                سيترتب على حذف بيانات المستخدم عدم الدخول إلى النظام مع الاحتفاظ بجميع الإجراءات الإدارية و المالية و العقود السابقة
                                                            </div>
                                                        }

                                                        <div style="width:20%;margin-right:5%;float:right;">
                                                            @if (ViewBag.delete == "D")
                                                            {
                                                                <input type="submit" name="delete" class="btn btn-primary waves-effect" value="@ViewBag.stat" id="modal-btn-si" style="float: left;" />
                                                            }
                                                            else
                                                            {
                                                                <input type="submit" name="delete" class="btn btn-primary waves-effect" value="@ViewBag.stat" id="modal-btn-si" style="float: left;" />
                                                            }
                                                            <button type="button" class="btn btn-primary" id="modal-btn-no" style="float: left;margin-top:25px;">إلغاء الأمر</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" id="H-modal">
                                            <div class="modal-dialog modal-dialog-centered">
                                                <div class="modal-content">
                                                    <div class="modal-body" style="padding: 35px;">
                                                        @if (Model.CR_Cas_User_Information_Status == "H")
                                                        {
                                                            <div style="width:75%;float:right;text-align:right;">
                                                                <b style="color:red;">تأكيد إسترجاع الإيقاف ......</b><br />
                                                                سيترتب على استرجاع إيقاف بيانات المستخدم إلى الدخول على النظام
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <div style="width:75%;float:right;text-align:right;">
                                                                <b style="color:red;">تأكيد الإيقاف ......</b><br />
                                                                سيترتب على إيقاف بيانات المستخدم إيقاف الدخول على النظام
                                                            </div>
                                                        }

                                                        <div style="width:20%;margin-right:5%;float:right;">
                                                            @if (Model.CR_Cas_User_Information_Status == "H")
                                                            {
                                                                <input type="submit" name="hold" class="btn btn-primary waves-effect" id="HoldModal-btn-si" value="@ViewBag.h" style="float: left;" />
                                                            }
                                                            else
                                                            {
                                                                <input type="submit" name="hold" class="btn btn-primary waves-effect" id="HoldModal-btn-si" value="@ViewBag.h" style="float: left;" />
                                                            }

                                                            <button type="button" class="btn btn-primary" id="HoldModal-btn-no" style="float: left;margin-top:25px">إلغاء الأمر</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        window.addEventListener("load", function () {

            if ('@TempData["TempModel"]'=="Added") {
                toastr.success("تم الحفظ بنجاح");
            }

            if ('@TempData["TempModel"]'=="Saved") {
                toastr.success("تم الحفظ بنجاح");
            }

            if ('@TempData["TempModel"]'=="Holded") {
                toastr.success("تم التعطيل بنجاح");
            }

            if ('@TempData["TempModel"]'=="Deleted") {
                toastr.success("تم الحذف بنجاح");
            }

            if ('@TempData["TempModel"]'=="Activated") {
                toastr.success("تم التنشيط بنجاح");
            }

        });
    </script>

 

    <script>
        function hideTable() {
            var checkBox = document.getElementById("CR_Cas_User_Information_Auth_Branch");
            if (checkBox.checked == true) {
                document.getElementById("BranchTable").style.display = "block";
            } else {
                document.getElementById("BranchTable").style.display = "none";
            }
            UncheckBranchTable();
        }
    </script>

</div>


<script>

    function Save() {
        var st = '@Model.CR_Cas_User_Information_Status';
        if (st == 'A') {
            document.getElementById("save").click();
        } else if (st == 'D') {
            toastr.info("لايمكن حفظ بيانات مستخدم محذوف");
        } else if (st == 'H') {
            toastr.info("لايمكن حفظ بيانات مستخدم موقوف");
        }
    }

    function Password() {
        var st = '@Model.CR_Cas_User_Information_Status';
        if (st == 'A') {
            document.getElementById("GetPassword").click();
        } else if (st == 'D') {
            toastr.info("عفوا هذا الحساب محذوف");
            return;
        } else if (st == 'H') {
            toastr.info("عفوا هذا الحساب موقوف");
            return;
        }
    }


</script>
<script>
    var modalConfirm = function (callback) {
        $("#btn-confirm").on("click", function () {
            var st = '@Model.CR_Cas_User_Information_Status';

            if (st == 'A') {
                var HaveReceipt = '@TempData["HaveReceipt"]';
                //alert(HaveReceipt);
                var x = false;
                if (HaveReceipt == "False")
                {
                    toastr.info("لا يمكن حذف مستخدم له رصيد");
                    return;
                }
                else
                {
                    x = true;
                }
                if (x == true) {
                    $("#mi-modal").modal('show');
                }
            } else if (st == 'D') {
                $("#mi-modal").modal('show');
            } else if (st == 'H') {
                toastr.info("لايمكن حذف مستخدم موقوف");
            }
        });
        $("#modal-btn-si").on("click", function () {
            callback(true);
            $("#mi-modal").modal('hide');
        });
        $("#modal-btn-no").on("click", function () {
            callback(false);
            $("#mi-modal").modal('hide');
        });
    };
    modalConfirm(function (confirm) {
        if (confirm) {
            //Acciones si el usuario confirma
            $("#form1").submit();
        } else {
            //Acciones si el usuario no confirma
            $("#result").html("canceled");
        }
    });
</script>
<script>
    var HoldModal = function (callback) {
        $("#btn-Hold").on("click", function () {
            var st = '@Model.CR_Cas_User_Information_Status';

            if (st == 'A') {
                var HaveReceipt = '@TempData["HaveReceipt"]';
                var x = true;
                //if (HaveReceipt === "False") {
                //    toastr.info("لايمكن إيقاف مستخدم له رصيد");
                //    return;
                //} else {
                //    x = true;
                //}

                if (x == true) {
                    $("#H-modal").modal('show');
                }
            } else if (st == 'H') {
                $("#H-modal").modal('show');
            } else if (st == 'D') {
                toastr.info("لايمكن إيقاف مستخدم محذوف");
            }

        });
        $("#HoldModal-btn-si").on("click", function () {
            callback(true);
            $("#H-modal").modal('hide');
        });
        $("#HoldModal-btn-no").on("click", function () {
            callback(false);
            $("#H-modal").modal('hide');
        });
    };
    HoldModal(function (confirm) {
        if (confirm) {
            //Acciones si el usuario confirma
            $("#form1").submit();
        } else {
            //Acciones si el usuario no confirma
            $("#result").html("canceled");
        }
    });
</script>
